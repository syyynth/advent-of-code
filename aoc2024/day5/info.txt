use topological sort on a single update
